<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>FFI Founder Copilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
      sans-serif;
    background: #FF7060;
    color: #111827;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
  }

  .app {
    width: 100%;
    max-width: 900px;
    background: #f9fafb;
    border-radius: 18px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    padding: 18px 18px 12px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
  }

  .app-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 4px;
  }

  .app-title {
    font-size: 24px;
    font-weight: 600;
    color: #0f172a;
  }

  .app-subtitle {
    font-size: 12px;
    color: #6b7280;
  }

  .hint {
    font-size: 11px;
    color: #6b7280;
    margin-top: -2px;
    margin-bottom: 4px;
  }

  .messages {
    flex: 1;
    height: 65vh;
    max-height: 65vh;
    min-height: 65vh;
    overflow-y: auto;
    padding: 8px 4px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    background: #ffffff;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.4);
  }

  .message {
    display: flex;
    gap: 8px;
    max-width: 80%;
  }

  .message.user {
    margin-left: auto;
    flex-direction: row-reverse;
  }

  .avatar {
    width: 28px;
    height: 28px;
    border-radius: 999px;
    background: #e5e7eb;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 600;
    color: #374151;
  }

  .avatar.user {
    background: #2563eb1a;
    color: #1d4ed8;
  }

  .avatar.ai {
    background: #006db2;
    color: #ffffff;
  }

  .bubble {
    padding: 10px 12px;
    border-radius: 14px;
    font-size: 14px;
    line-height: 1.4;
    white-space: pre-wrap;
  }

  .bubble.user {
    background: #2563eb;
    color: #f9fafb;
    border-bottom-right-radius: 4px;
  }

  .bubble.ai {
    background: #ffffff;
    border: 1px solid rgba(148, 163, 184, 0.6);
    border-bottom-left-radius: 4px;
    color: #111827;
  }

  .bubble-content {
    margin-bottom: 6px;
  }

  .bubble-toolbar {
    display: flex;
    justify-content: flex-end;
  }

  .bubble-copy-btn {
    border: none;
    border-radius: 999px;
    padding: 3px 10px;
    font-size: 11px;
    background: #e5e7eb;
    color: #374151;
    cursor: pointer;
    transition: background-color 0.1s ease-out, transform 0.06s ease-out;
  }

  .bubble-copy-btn:hover {
    background: #d1d5db;
    transform: translateY(-1px);
  }

  .bubble-copy-btn:active {
    transform: translateY(0);
  }

  /* Loader */

  .bubble.loading {
    background: #f3f4f6;
    border: 1px solid rgba(148, 163, 184, 0.6);
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding-top: 8px;
    padding-bottom: 8px;
  }

  .skeleton-line {
    height: 8px;
    border-radius: 999px;
    background: #e5e7eb;
    overflow: hidden;
  }

  .skeleton-line.short {
    width: 60%;
  }

  .shimmer {
    position: relative;
    overflow: hidden;
  }

  .shimmer::before {
    content: "";
    position: absolute;
    inset: 0;
    transform: translateX(-100%);
    background: linear-gradient(
      120deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0.7) 40%,
      rgba(255, 255, 255, 0) 80%
    );
    animation: shimmer 1.3s infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  .loading-status {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    color: #6b7280;
    margin-top: 2px;
  }

  .dots {
    display: flex;
    gap: 4px;
  }

  .dot {
    width: 5px;
    height: 5px;
    border-radius: 999px;
    background: #9ca3af;
    opacity: 0.4;
    animation: pulse 1s infinite ease-in-out;
  }

  .dot:nth-child(2) { animation-delay: 0.15s; }
  .dot:nth-child(3) { animation-delay: 0.3s; }

  @keyframes pulse {
    0%, 100% { transform: scale(0.85); opacity: 0.3; }
    50% { transform: scale(1.1); opacity: 1; }
  }

  /* Input */

  .input-row {
    display: flex;
    gap: 8px;
    margin-top: 4px;
    padding-top: 8px;
    border-top: 1px solid rgba(209, 213, 219, 0.9);
  }

  .input {
    flex: 1;
    resize: none;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid #cbd5f5;
    background: #ffffff;
    color: #111827;
    font-size: 14px;
    min-height: 46px;
    max-height: 120px;
    line-height: 1.4;
  }

  .input::placeholder {
    color: #9ca3af;
  }

  .input:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.15);
  }

  .send-btn {
    border: none;
    border-radius: 999px;
    padding: 0 18px;
    font-size: 14px;
    font-weight: 600;
    background: #FF7060;
    color: #000000;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    box-shadow: 0 10px 25px rgba(34, 197, 94, 0.25);
    transition: transform 0.07s ease-out, box-shadow 0.07s ease-out;
  }

  .send-btn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 14px 30px rgba(34, 197, 94, 0.28);
    background: #16a34a;
  }

  .send-btn:disabled {
    opacity: 0.6;
    cursor: default;
  }
  .ffi-logo {
  height: 42px;           /* GrÃ¶ÃŸe anpassbar */
  width: auto;
  margin-right: 12px;
  border-radius: 8px;     /* falls du abgerundete Ecken willst */
}

</style>
</head>

<body>
  <div class="app">

    <div class="app-header">
  		<img src="/static/ffi-logo.png" class="ffi-logo" alt="FFI Logo">

  		<div>
    		<div class="app-title">FFI Founder Copilot</div>
    		<div class="app-subtitle">Dein persÃ¶nlicher FFI-Assistent Â· lokal mit Ollama</div>
  		</div>
	</div>

    <div class="hint">
      Beschreibe deine Gedanken oder dein Projekt. Der Copilot wird dir helfen, auf Basis der bishergien FFI-Erfahrung deine Projekte zu boosten.
    </div>

    <div id="messages" class="messages"></div>

    <form id="chat-form" class="input-row">
      <textarea
        id="input"
        class="input"
        placeholder="Was geht bei dir ab? Beschreibe kurz, mit was ich dir weiterhelfen kann..."
      ></textarea>

      <button type="submit" id="send-btn" class="send-btn">Senden</button>
    </form>

  </div>

  <script>
    const form = document.getElementById("chat-form");
    const input = document.getElementById("input");
    const messagesEl = document.getElementById("messages");
    const sendBtn = document.getElementById("send-btn");

    let isLoading = false;
    let loaderEl = null;

    /* ENTER = SENDEN / SHIFT+ENTER = NEUE ZEILE */
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        form.dispatchEvent(new Event("submit", { cancelable: true }));
      }
    });

    /* MESSAGE EINTRAGEN */
    function addMessage(role, text) {
      const wrapper = document.createElement("div");
      wrapper.className = "message " + role;

      const avatar = document.createElement("div");
      avatar.className = "avatar " + role;
      avatar.textContent = role === "user" ? "DU" : "FFI";

      const bubble = document.createElement("div");
      bubble.className = "bubble " + role;

      if (role === "ai") {
        const contentEl = document.createElement("div");
        contentEl.className = "bubble-content";
        contentEl.textContent = text;

        const toolbar = document.createElement("div");
        toolbar.className = "bubble-toolbar";

        const copyBtn = document.createElement("button");
        copyBtn.type = "button";
        copyBtn.className = "bubble-copy-btn";
        copyBtn.textContent = "Kopieren";

        /* Copy mit Safari-Fallback */
        copyBtn.addEventListener("click", async () => {
          const oldText = copyBtn.textContent;

          try {
            if (navigator.clipboard && navigator.clipboard.writeText) {
              await navigator.clipboard.writeText(text);
            } else {
              const tempArea = document.createElement("textarea");
              tempArea.value = text;
              tempArea.style.position = "fixed";
              tempArea.style.left = "-9999px";
              document.body.appendChild(tempArea);
              tempArea.focus();
              tempArea.select();
              document.execCommand("copy");
              document.body.removeChild(tempArea);
            }

            copyBtn.textContent = "Kopiert âœ“";
            setTimeout(() => { copyBtn.textContent = oldText; }, 1500);

          } catch (err) {
            copyBtn.textContent = "Fehler ðŸ˜•";
            setTimeout(() => { copyBtn.textContent = oldText; }, 1500);
          }
        });

        toolbar.appendChild(copyBtn);
        bubble.appendChild(contentEl);
        bubble.appendChild(toolbar);

      } else {
        bubble.textContent = text;
      }

      wrapper.appendChild(avatar);
      wrapper.appendChild(bubble);
      messagesEl.appendChild(wrapper);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    /* LOADER */
    function showLoader() {
      if (isLoading) return;
      isLoading = true;
      sendBtn.disabled = true;

      const wrapper = document.createElement("div");
      wrapper.className = "message ai";

      const avatar = document.createElement("div");
      avatar.className = "avatar ai";
      avatar.textContent = "FFI";

      const bubble = document.createElement("div");
      bubble.className = "bubble ai loading";

      const line1 = document.createElement("div");
      line1.className = "skeleton-line shimmer";

      const line2 = document.createElement("div");
      line2.className = "skeleton-line shimmer";

      const line3 = document.createElement("div");
      line3.className = "skeleton-line short shimmer";

      const status = document.createElement("div");
      status.className = "loading-status";

      const dots = document.createElement("div");
      dots.className = "dots";
      for (let i = 0; i < 3; i++) {
        const d = document.createElement("div");
        d.className = "dot";
        dots.appendChild(d);
      }

      const label = document.createElement("span");
      label.textContent = "FFI Copilot analysiert deine Ideeâ€¦";

      status.appendChild(dots);
      status.appendChild(label);

      bubble.appendChild(line1);
      bubble.appendChild(line2);
      bubble.appendChild(line3);
      bubble.appendChild(status);

      wrapper.appendChild(avatar);
      wrapper.appendChild(bubble);

      messagesEl.appendChild(wrapper);
      messagesEl.scrollTop = messagesEl.scrollHeight;

      loaderEl = wrapper;
    }

    function hideLoader() {
      if (!isLoading) return;
      isLoading = false;
      sendBtn.disabled = false;
      if (loaderEl && loaderEl.parentNode) {
        loaderEl.parentNode.removeChild(loaderEl);
      }
      loaderEl = null;
    }

    /* FORM SENDEN */
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const text = input.value.trim();
      if (!text || isLoading) return;

      addMessage("user", text);
      input.value = "";
      showLoader();

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            messages: [{ role: "user", content: text }],
          }),
        });

        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        hideLoader();
        addMessage("ai", data.reply || "Keine Antwort erhalten.");

      } catch (err) {
        hideLoader();
        addMessage("ai", "Fehler bei der Kommunikation mit dem Backend: " + err);
      }
    });
  </script>
</body>
</html>
